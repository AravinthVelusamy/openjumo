var JUMO={timesSearched:0,Modules:{},initialize:function(a){this.browserIsIE=jQuery.browser.msie;this.isErrorPage=a.isErrorPage;this.isEntityPage=a.entityID?!0:!1;if(this.isSignedIn=a.userName?!0:!1)this.user={id:a.userID,name:a.userName,ageGroup:a.userAgeGroup,gender:a.userGender,fbAccessToken:a.fbAccessToken},this.setupTopNav();if(this.isEntityPage)this.entity={name:a.entityName,id:a.entityID};this.Modules.Popup.initialize("#templates .notification","#templates .org_hoverbox");this.Modules.Search.initialize();
this.setupMouseEvents();this.Util.parseUrlHash(this.Util.getHash())},setupMouseEvents:function(){var a=this;jQuery("#create_account_button .button").click(function(){a.Util.fbLogin(jQuery(this))});jQuery("#page-content .showall").click(function(){var b=jQuery(this).attr("id").replace("#",""),b=jQuery("#templates ."+b);a.Modules.Popup.showPopupForJobj(b)});this.isEntityPage&&jQuery(".cs .youtube_thumb").click(function(){var b=jQuery(this).attr("id");a.Util.showYoutubeVideo(b,b,b.replace("youtube_",
""))})},setupTopNav:function(){var a=this,b=jQuery("#nav_account_tab"),c=jQuery("#nav_menu");b.click(function(){c.toggle();jQuery(this).toggleClass("active")});jQuery("body").click(function(d){if(c.is(":visible")){var d={x:d.clientX,y:d.clientY},e=a.Util.jObjToPoly(b),f=a.Util.jObjToPoly(c);!a.Util.isPointInPoly(e,d)&&!a.Util.isPointInPoly(f,d)&&(c.hide(),b.removeClass("active"))}})}},JUMOFB={parent:JUMO,updateToken:function(a){this.parent.user.fbAccessToken=a;$.ajax({url:"/json/v1/user/fbot_update",
data:{ot:a},type:"post",success:function(){},error:function(){}})},checkAuth:function(a){this.callback=a;var b=this;this.parent.user&&FB.getLoginStatus(function(a){if(a.session==null)return FB.login(function(a){a.session.access_token!=b.parent.user.fbAccessToken&&(JUMOFB.updateToken(a.session.access_token),b.callback())},{perms:"publish_stream, offline_access, user_birthday"});else a.session.access_token!=b.parent.user.fbAccessToken&&JUMOFB.updateToken(a.session.access_token);b.callback()})},displayFbName:function(){typeof FB!==
"undefined"&&FB.api("/me",function(a){jQuery("#fb_name").text(a.first_name+" "+a.last_name)})},setupFBLogin:function(a,b){var c=function(a,b){jQuery.ajax({url:"/json/v1/user/fb_login",data:{id:a,ot:b},type:"post",success:function(){var a=jQuery("input[name=redirect_to]");window.location=a.length>0?a.val():"/"},error:function(){}})};jQuery("#fb_single_signin").click(function(){jQuery("#fb_single_signin").before('<div class="loading-row"></div>');a?c(a,b):FB.login(function(a){a.session?c(a.session.uid,
a.session.access_token):jQuery("#fb_single_signin").siblings(".loading-row").remove()})})},displayLogin:function(){var a=this;typeof FB!=="undefined"&&FB.getLoginStatus(function(b){if(b.session){var c=b.session.uid,d=b.session.access_token;jQuery("#fb_login").show();jQuery("#fb_profile_pic").attr("src","http://graph.facebook.com/"+c+"/picture?type=square");a.displayFbName();a.setupFBLogin(c,d)}else a.setupFBLogin(void 0,d)})}};if(!Array.prototype.map)Array.prototype.map=function(a,b){if(this===void 0||this===null)throw new TypeError;var c=Object(this),d=c.length>>>0;if(typeof a!=="function")throw new TypeError;for(var e=Array(d),f=0;f<d;f++)f in c&&(e[f]=a.call(b,c[f],f,c));return e};
if(!Array.prototype.reduce)Array.prototype.reduce=function(a){if(this===void 0||this===null)throw new TypeError;var b=Object(this),c=b.length>>>0;if(typeof a!=="function")throw new TypeError;if(c==0&&arguments.length==1)throw new TypeError;var d=0,e;if(arguments.length>=2)e=arguments[1];else{do{if(d in b){e=b[d++];break}if(++d>=c)throw new TypeError;}while(1)}for(;d<c;)d in b&&(e=a.call(void 0,e,b[d],d,b)),d++;return e};
if(!Array.prototype.filter)Array.prototype.filter=function(a,b){if(this===void 0||this===null)throw new TypeError;var c=Object(this),d=c.length>>>0;if(typeof a!=="function")throw new TypeError;for(var e=[],f=0;f<d;f++)if(f in c){var g=c[f];a.call(b,g,f,c)&&e.push(g)}return e};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a,b){var c=this.length,d=Number(b)||0,d=d<0?Math.ceil(d):Math.floor(d);for(d<0&&(d+=c);d<c;d++)if(d in this&&this[d]===a)return d;return-1};
Object.keys=Object.keys||function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c);return b};var JSON;JSON||(JSON={});
(function(){function a(a){return a<10?"0"+a:a}function b(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var b=j[a];return typeof b==="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(a,d){var e,j,m,n,o=f,k,h=d[a];h&&typeof h==="object"&&typeof h.toJSON==="function"&&(h=h.toJSON(a));typeof l==="function"&&(h=l.call(d,a,h));switch(typeof h){case "string":return b(h);case "number":return isFinite(h)?String(h):"null";case "boolean":case "null":return String(h);
case "object":if(!h)return"null";f+=g;k=[];if(Object.prototype.toString.apply(h)==="[object Array]"){n=h.length;for(e=0;e<n;e+=1)k[e]=c(e,h)||"null";m=k.length===0?"[]":f?"[\n"+f+k.join(",\n"+f)+"\n"+o+"]":"["+k.join(",")+"]";f=o;return m}if(l&&typeof l==="object"){n=l.length;for(e=0;e<n;e+=1)j=l[e],typeof j==="string"&&(m=c(j,h))&&k.push(b(j)+(f?": ":":")+m)}else for(j in h)Object.hasOwnProperty.call(h,j)&&(m=c(j,h))&&k.push(b(j)+(f?": ":":")+m);m=k.length===0?"{}":f?"{\n"+f+k.join(",\n"+f)+"\n"+
o+"}":"{"+k.join(",")+"}";f=o;return m}}if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,g,j={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;if(typeof JSON.stringify!=="function")JSON.stringify=function(a,b,d){var e;g=f="";if(typeof d==="number")for(e=0;e<d;e+=1)g+=" ";else typeof d==="string"&&(g=d);if((l=b)&&typeof b!=="function"&&(typeof b!=="object"||typeof b.length!=="number"))throw Error("JSON.stringify");return c("",
{"":a})};if(typeof JSON.parse!=="function")JSON.parse=function(a,b){function c(a,d){var e,f,g=a[d];if(g&&typeof g==="object")for(e in g)Object.hasOwnProperty.call(g,e)&&(f=c(g,e),f!==void 0?g[e]=f:delete g[e]);return b.call(a,d,g)}var e,a=String(a);d.lastIndex=0;d.test(a)&&(a=a.replace(d,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e=eval("("+a+")"),typeof b==="function"?c({"":e},""):e;throw new SyntaxError("JSON.parse");}})();JUMO.Util={parent:JUMO,popup:JUMO.Modules.Popup,defaultErrorMessage:"An unknown error has occured.",sentenceCase:function(){return this.toLowerCase().replace(/^(.)|\s(.)/g,function(a){return a.toUpperCase()})},parseUrlHash:function(a){if(a!==void 0&&this.entity!==void 0)return jQuery("#"+id).addClass("highlight");this.getUrlParameterByName("new_user")&&jQuery(".new_user").show()},clearInputs:function(){jQuery("input[type=text]").val("")},areObjectsEquivalent:function(a,b){for(var c in a)if(typeof b[c]==
"undefined")return!1;for(c in a)if(a[c])switch(typeof a[c]){case "object":if(!this.areObjectsEquivalent(a[c],b[c]))return!1;break;case "function":if(typeof b[c]=="undefined"||c!="equals"&&a[c].toString()!=b[c].toString())return!1;break;default:if(a[c]!=b[c])return!1}else if(b[c])return!1;for(c in b)if(typeof a[c]=="undefined")return!1;return!0},clone:function(a,b,c){b===void 0&&(b={});for(var d in a)if(c===void 0||c.indexOf(d)<0)b[d]=a[d];return b},uniqueArray:function(a){var b=[],c=0,d=a.length;
a:for(;c<d;c++){for(var e=0,f=b.length;e<f;e++)if(b[e]==a[c])continue a;b[b.length]=a[c]}return b},isPointInPoly:function(a,b){for(var c=!1,d=-1,e=a.length,f=e-1;++d<e;f=d)(a[d].y<=b.y&&b.y<a[f].y||a[f].y<=b.y&&b.y<a[d].y)&&b.x<(a[f].x-a[d].x)*(b.y-a[d].y)/(a[f].y-a[d].y)+a[d].x&&(c=!c);return c},jObjToPoly:function(a){var b=a.offset(),c=a.width(),a=a.height();return b&&b.left?[{x:b.left-1,y:b.top},{x:b.left+c+15,y:b.top},{x:b.left+c+15,y:b.top+a},{x:b.left-1,y:b.top+a},{x:b.left-1,y:b.top}]:[{}]},
str_trim:function(a){return a!==void 0?a.replace(/^\s+|\s+$/g,""):a},trim:function(a){return a?a.trim!==void 0?a.trim():this.str_trim(a):""},replaceAll:function(a,b,c){for(var d=0;d>=0;)d=a.indexOf(b,d+c.length),a=a.substring(0,d)+a.substring(d).replace(b,c);return a},isDateLike:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(typeof b!="object"||b===null||typeof b.getTime!="function")return!1}return!0},isArrayLike:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a],
c=typeof b;if(c!="object"&&!(c=="function"&&typeof b.item=="function")||b===null||typeof b.length!="number")return!1}return!0},isNumeric:function(a){String(a).replace("\n","").replace("\r","").replace("\t","").replace(" ","");return a-0==a&&a.length>0},sum:function(a){return a.reduce(function(a,c){return!c?a:a+c},0)},handleFollowSuccess:function(a,b,c){b.removeClass(c);c=="follow"?b.attr("src")?b.addClass("unfollow").attr({src:"/static/img/unfollow_small.png"}):b.find("img").length>0?b.removeClass("disabled").addClass("unfollow").find("img").attr({src:"/static/img/unfollow_img.png"}):
b.addClass("unfollow").text("Unfollow"):b.attr("src")?b.addClass("follow").attr({src:"/static/img/follow_small.png"}):b.find("img").length>0?b.removeClass("disabled").addClass("follow").find("img").attr({src:"/static/img/follow_img.png"}):b.addClass("follow").text("Follow")},handleFollowFail:function(a){this.handelError(a)},handleError:function(a){this.popup.showErrorPopup(this.getParsedErrorText(a))},getParsedErrorText:function(a){var b="There was an error processing your request. Please try submitting again.";
a&&a.error&&(b="("+a.error_code+") "+a.error);return b},addLoadingImg:function(a){a.append('<img class="loading" src="/static/img/ajax-loader.gif" />').css({opacity:0.5})},removeLoadingImg:function(a){a.css({opacity:1}).parent().find(".loading, .sm_loading").remove()},addSmallLoadingImg:function(a){a.append('<img class="sm_loading" src="/static/img/ajax-loader_sm.gif" />').css({opacity:0.5})},followUnfollow:function(a,b,c,d){var e=this,f=d.hasClass("unfollow")?"unfollow":"follow";try{this.addLoadingImg(d)}catch(g){}this.postJSON("user/action/follow/",
{items:a,item_type:b,user_id:c,action:f},function(c){e.removeLoadingImg(d);return c.result!==void 0?(e.parent.Modules.Tracking.trackAction(f,{"Followed ID":a,"Followed Type":b}),e.handleFollowSuccess(c,d,f)):e.handleFollowFail(c,d)})},postJSONandDisplayLoading:function(a,b,c,d,e){var f=this,g=this.showLoading(d,e);this.postJSON(a,b,c,function(){f.hideLoading(d,e,g)})},save:function(a,b){try{if(a.hasClass("disabled"))return!1;this.addLoadingImg(a.parent());Checker.disableSubmit(a);Checker.clearError(a);
b()}catch(c){a.removeClass("disabled"),Checker.showError(a,JSON.stringify(c)),this.removeLoadingImg(a.parent())}},showHTTPError:function(a){jQuery(".button.disabled").removeClass("disabled");a&&a.status==404||(a&&a.status==502?JUMO.Modules.Popup.showErrorPopup("Error: you place an incorrectly formed request"):JUMO.Modules.Popup.showErrorPopup("An unknown error has occured."))},postJSON:function(a,b,c,d,e){var f=this;b._xsrf=function(a){return(a=document.cookie.match("\\b"+a+"=([^;]*)\\b"))?a[1]:void 0}("_xsrf");
jQuery.ajax({type:"POST",url:"/json/v1/"+a,data:b,success:function(a){try{c(eval(a)),d&&d()}catch(b){f.popup.showErrorPopup(JSON.stringify(b))}},error:e?function(){e(f.defaultErrorMessage);jQuery(".button.disabled").removeClass("disabled")}:this.showHTTPError,dataType:"json"})},ajaxPost:function(a){return this.ajaxRequest(a,"POST")},ajaxGet:function(a){return this.ajaxRequest(a,"GET")},ajaxRequest:function(a,b){var c={type:b,data:{},dataType:"json",error:jQuery.proxy(this.handleAjaxError,this)},c=
jQuery.extend(c,a);if(b=="POST")c.data._xsrf=function(a){return(a=document.cookie.match("\\b"+a+"=([^;]*)\\b"))?a[1]:void 0}("_xsrf");return jQuery.ajax(c)},handleAjaxError:function(a){var a=parseInt(a.status,10),b="There was an error processing your request. Please try submitting again.";switch(a){default:b+=" (code: "+a+")"}this.popup.showErrorPopup(b)},initPlaceholder:function(a){return a.val(a.attr("placeholder")).addClass("placeholder")},fixPlaceHolder:function(a,b){var c=this.trim(a.val())||
this.trim(a.text()),d=this.trim(a.attr("placeholder"));b=="focusin"&&a.removeClass("placeholder");d==c||!c&&b=="focus"?a.val("").removeClass("placeholder"):(!c&&b=="focusout"||!c&&b=="blur")&&a.val(d).addClass("placeholder")},getFormVal:function(a){var b=this.trim(a.val()),a=this.trim(a.attr("placeholder"));return b==a?"":b},linkifyTweet:function(a){return a.replace(/(^|\s)(@\w+)/gm,'$1<a href="http://twitter.com/$2">$2</a>')},showhideTabs:function(a,b){a=a.replace(" selected","");a=a.split(" ")[0];
b.map(function(b){var d=jQuery("#"+b);b!=a?(jQuery("."+b).removeClass("selected"),d.hide(0)):(jQuery("."+b).addClass("selected"),jQuery(window).scrollTop(0),d.show())})},getUrlParameterByName:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=RegExp("[\\?&]"+a+"=([^&#]*)").exec(window.location.href);return a==null?"":decodeURIComponent(a[1].replace(/\+/g," "))},reverse:function(a){for(var b=new String,c=a.length;c--;)b+=a.charAt(c);return b},resizeIt:function(a){var b=a.val(),c=a.attr("cols"),
d=0;b.split("\n").map(function(a){d+=1+Math.floor(a.length/c)});a.attr({rows:d>3?d:3})},resizeItSmall:function(a){var b=a.val(),c=a.attr("cols"),d=0;b.split("\n").map(function(a){d+=1+Math.floor(a.length/c)});a.attr({rows:d})},makeCharCountDiv:function(a,b,c){var d=!1;a.bind("keyup click blur focus change paste",function(){var a=c-jQuery(this).val().length;a<50?(d||b.show(),d=!0,b.html(a)):(d&&b.hide(),d=!1)})},_stripHtml:function(a){return jQuery("<div>"+a+"</div>").text()},stripHtml:function(a){a=
this._stripHtml(a);return this._stripHtml("<\n>")!=="&lt;\n&gt;"?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):a},formatString:function(a){return this.stripHtml(a).replace("\n"," ").replace("\r"," ").replace("<","(").replace(">",")").replace("\u201c",'"').replace("\u201d",'"').replace("'","'").replace("\u2018","'").replace("\u2019","'").replace("\u2013","-").replace(">",")").replace("\\","/").replace(/"(?=\w|$)/g,"&#8220;").replace(/\b"/g,"&#8221;")},isValidString:function(a){return/^[\w \d \. \, \' \" \: \@ \; \? \- \# \\u2013 \& \( \) \! \s \: \; \- \! \r \+ \/ \* \\u2014 \\u2019]+$/i.test(a)},
matchDivPosition:function(a,b){a.css({top:b.top+17,left:b.left-25})},showLoading:function(a){a.click(function(a){a.stopPropagation();return!1});a.fadeTo("slow",0.5);return a.after('<img class="loading" src=\'/static/img/loading.gif>')},getSmallImageForEntity:function(a){var b;a.img_url?b=a.img_url:a.facebook_id&&(b="http://graph.facebook.com/"+a.facebook_id+"/picture?type=square");return'<img src="'+b+'" class="sm_image" />'},hideLoading:function(a,b,c){a.click(function(a){a.stopPropagation();return!0});
a.fadeTo("slow",1);c.remove()},getUrlVars:function(){for(var a=[],b,c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++)b=c[i].split("="),a.push(b[0]),a[b[0]]=b[1];return a},getInputVal:function(a){return this.trim(a.val())},getUrlVar:function(a){return this.getUrlVars()[a]},getHash:function(){return window.location.hash!==void 0&&window.location.hash.length>0?window.location.hash.slice().replace("#",""):void 0},checkUserExists:function(a,b,c){this.postJSON("user/fbid_check/",
{fbid:a},function(a){Number(a.error_code)<1&&a.result!==void 0?a.result.exists>0?c('Your Facebook account is already using Jumo. Please <a href="/login">login</a>'):b():c(a.error_code)})},showYoutubeVideo:function(a,b,c,d,e){return swfobject.embedSWF("http://www.youtube.com/v/"+c+"?enablejsapi=1&playerapiid=ytplayer&autoplay=1&allowfullscreen=true&version=3&autohide=1&showinfo=0",a,d?String(d):"200",e?String(e):"160","8",null,null,{allowfullscreen:"true",play:"true",loop:"false",menu:"true"},{id:b})},
fbLogin:function(a){var b=this;FB.login(function(c){c.session!==void 0&&c.session!==null&&c.session.uid!==void 0?b.checkUserExists(c.session.uid,function(){window.location="/setup"},function(b){a.parent().find(".notification").show().html(b)}):a.parent().find(".notification").show().html('Your Facebook account is already using Jumo. Please <a href="/login"><b>login</b></a>')},{perms:"publish_stream, offline_access"})},capitalize:function(a){return a.replace(/(^|\s)([a-z])/g,function(a,c,d){return c+
d.toUpperCase()})}};JUMO.Modules.Popup={parent:JUMO,initialize:function(a,b){this.mainDiv=jQuery(a);this.orgInfoPopup=jQuery(b).clone().hide().appendTo("#page-content");this.setupCommitmentPopup();this.setupFollowerPopups();this.setupCloseEvent();return this},setupCommitmentPopup:function(){var a=this;jQuery(".delete_commitment").live("click",function(a){a.preventDefault();var c=jQuery(this),a=c.parents("form"),d=c.attr("data-url");JUMO.Util.ajaxPost({url:d,data:a.serialize(),success:function(a){a!==void 0&&a.result!==
void 0&&c.parents(".commitment_button").replaceWith(a.result.button)}})});jQuery(".section.photos li").click(function(){var b=jQuery(this),c=b.attr("data-fullsize"),b=b.attr("data-caption");a.showLargePhotoPopup(c,b)});jQuery(".create_commitment").live("click",function(b){if(a.parent.user&&a.parent.user.id){b.preventDefault();var c=jQuery(this),b=c.parents("form"),d=c.attr("data-url"),e=c.attr("data-with_popup");JUMO.Util.ajaxPost({url:d,data:b.serialize(),success:function(b){b!==void 0&&b.result!==
void 0&&(c.parents(".commitment_button").replaceWith(b.result.button),e>0&&a.showActionPopup(b.result.actions))}})}else a.showLoginCreateAccountPopup()});jQuery(".view_actions").live("click",function(b){b.preventDefault();b=jQuery(this).attr("data-url");JUMO.Util.ajaxGet({url:b,success:function(b){b!==void 0&&b.result!==void 0&&a.showActionPopup(b.result.html)}})})},setupFollowerPopups:function(){var a=this;jQuery("#committed_users, #user_followers, #user_following, #issues_following, #orgs_following").live("click",
function(b){b.preventDefault();var b=jQuery(this).attr("data-url"),c=jQuery(this).attr("data-title")||"";a.showFollowersPopup(b,c)})},showFollowersPopup:function(a,b){var c=this,d=c.showPopupForJobj(jQuery("#templates .entitylist_popup"),420),e=function(){d.find(".rounded_box").append('<div class="loading-row"></div>');JUMO.Util.ajaxGet({url:a,data:{start:d.data("start"),end:d.data("end")},success:jQuery.proxy(f,c)})},f=function(b){var c=b.result.html,b=b.result.has_more===!0;d.find(".loading-row").remove();
d.find(".rounded_box").append(c);b&&d.find(".rounded_box").asyncScroller("reset",{pollInterval:2E3,bottomHitArea:200}).one("scrollEnd.asyncScroller",function(){var b=$(this);d.data("start",d.data("start")+19+1).data("end",d.data("start")+19);e(a);b.asyncScroller("destroy")}).append('<div class="loading-row"></div>')};d.find(".heading").html(b);d.data("start",0).data("end",19);e(a)},showLargePhotoPopup:function(a,b){var c=jQuery("#templates .photo_viewer_popup");c.find(".fullsize").attr("src",a).end().find(".caption").text(b);
this.showPopupForJobj(c)},showActionPopup:function(a){this.showPopupForJobj(jQuery("#templates .action_popup"),500).find(".sm_info").html(a)},setupCloseEvent:function(){var a=this;jQuery(".submit_spacer .button, .close",jQuery("#notification")).live("click",function(){return a.hidePopup(jQuery(this))});jQuery("#popup_box").live("click keyup",function(b){a.hidePopup(jQuery(this));b.stopPropagation();return!1})},getPos:function(a,b,c,d){if(a===void 0)a=c.position().top,b=c.position().left;b+d>document.width&&
(b=document.width-d-15);a+=c.height()+20;b-=12;return{top:a,left:b}},showUploadUserPhoto:function(){var a=this,b=this.showPopupForJobj(jQuery("#templates .photo_upload_popup"),420);b.find(".close").click(function(){a.hidePopup(b)})},showSuccessPopup:function(a,b){var c=jQuery("#notification").addClass("success top");c.text(a).css({width:"80px"}).slideDown(300,function(){setTimeout(function(){c.slideUp(300)},3E3)});this.parent.Util.matchDivPosition(c,b)},getPopupPosition:function(a,b,c){return{width:a+
"px",top:jQuery(window).scrollTop()+75,left:b/2-a/2-c/2+"px",position:"absolute","z-index":11,padding:c}},showPopupForJobj:function(a,b,c){var b=b||420,c=c||30,d=jQuery(window).width();jQuery(window).height();this.hidePageContent();return jQuery("#notification").removeClass().addClass("popup notification").html("").css(this.getPopupPosition(b,d,c)).append(a.clone()).show()},showFBConnectPopup:function(){var a=this;this.showPopupForJobj(jQuery("#templates .fb_connect_login"),420).find("#fb_login").click(function(){a.parent.Util.fbLogin(jQuery(this))})},
showLoginPopup:function(){this.showPopupForJobj(jQuery("#templates .login"),420).find("#login").click(function(){window.location="/login"})},showLoginCreateAccountPopup:function(){var a=this,b=this.showPopupForJobj(jQuery("#templates .loginCreateAccount"),420);b.find("#login").click(function(){window.location="/login"});b.find("#fb_login").click(function(){a.parent.Util.fbLogin(jQuery(this))})},showErrorPopup:function(a){this.showPopupForJobj(jQuery("#templates .error_popup"),420).find(".error_text").text(a)},
hidePageContent:function(){this.pageOverlay=jQuery('<div id="popup_box"></div').css({position:"fixed",width:jQuery(window).width()+"px",height:jQuery(window).height()+"px",top:"0px",left:"0px",background:"#f3f3f3",opacity:"0.9","z-index":10});jQuery("body").append(this.pageOverlay)},hideLoginPopup:function(){jQuery("#notification").removeClass().hide().css({position:"absolute"});this.pageOverlay.remove()},hideOrgInfoPopup:function(){this.orgInfoPopup.hide()},hidePopup:function(a){jQuery("#notification").removeClass().hide().css({position:"absolute"});
jQuery("#popup_box").remove();this.parent.Modules.Popup.pageOverlay?this.parent.Modules.Popup.pageOverlay.remove():jQuery(a).parent().parent().hide()},show:function(){this.mainDiv.show()},hide:function(){this.mainDiv.hide()}};
(function(a){var b=!1,c={bottomHitArea:50,pollInterval:1E3},d=function(){var b=a(this),d=0;b.get(0).scrollHeight&&typeof(b.get(0).scrollHeight==="number")?d=b.get(0).scrollHeight:b.children().each(function(){d+=a(this).outerHeight()});return d-(b.innerHeight()+b.scrollTop())<c.bottomHitArea},e=function(c){var f=this,l=setTimeout(function(){clearTimeout(l);a.proxy(d,f)()||!b?a(f).trigger("scrollEnd.asyncScroller"):a.proxy(e,f)(c)},c)},f={init:function(d){var f=this;d&&a.extend(c,d);return this.each(function(){a(this).unbind("scroll").one("scroll",
function(){b=!0;a(this).unbind("scroll");a.proxy(e,f)(Math.max(c.pollInterval,250))})})},destroy:function(){return this.each(function(){a(this).unbind(".asyncScroller");clearTimeout()})},reset:function(b){var c=this;return this.each(function(){a.proxy(f.init,c)(b)})}};a.fn.asyncScroller=function(b){if(f[b])return f[b].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof b==="object"||!b)return f.init.apply(this,arguments);else a.error(b+" does not exist on jQuery.asyncScroller")}})(jQuery);JUMO.Modules.Search={parent:JUMO,initialize:function(){var a=this;this.timesSearched=0;this.searchInput=jQuery("#searchbar");this.searchForm=jQuery("#searchbar").parent();this.termCompleteInput=jQuery("input.termcomplete");this.setupSearch(this.searchInput,[],function(b){a.parent.Modules.Tracking.trackActionSYNC("Search Found",{query:b.query,"item found":b.name,"item index":b.index,"times searched":a.timesSearched},function(){return window.location=b.url})},"all_orgtypes");this.termCompleteInput.length&&
this.setupTermCompletion(this.termCompleteInput);this.parent.isErrorPage&&this.setupSearch(jQuery("#errorsearchbar"),[],function(a){return window.location=a.url},"all_orgtypes")},setupSearch:function(a,b,c,d){var e=this;if(a&&!(a.length<1)){var f=a.attr("placeholder");a.val(f).focus(function(){if(a.val()==f)return a.val("").removeClass("placeholder")}).focusout(function(){a.val().length<1&&a.val(f).addClass("placeholder")}).autocomplete({source:function(a,b){JUMO.Util.ajaxGet({url:"/json/v1/search/onebox",
data:{search:a.term,restrict_type:d},success:function(a){e.timesSearched+=1;return a&&a.result?b(a.result):b([])},error:function(){b([])}})},minLength:2,select:function(b,d){d.item.query=a.val();a.val(d.item.name);c(d.item);return!1}}).data("autocomplete")._renderItem=function(a,b){return b?(jQuery('<li class="clearfix"></li>').data("item.autocomplete",b).append(e.getSearchHtmlForEntity(b)).appendTo(a),b):""};this.searchForm.submit(function(){a.val()==f&&a.val("");return!0})}},getHRTypeForType:function(a){return a==
"user"?"person":a=="org"?"project":a},getSearchHtmlForEntity:function(a){var b=this.browserIsIE?"":"</span>";return"<a>"+(a.image_url?"<img src='"+a.image_url+"' />":"")+"<"+(this.browserIsIE?"div":"span")+' class="result_container"><span class="name">'+a.name+'</span><span class="followers">'+a.num_followers+" people follow this <b>"+this.getHRTypeForType(a.type)+"</b></span>"+b+"</a>"},setupTermCompletion:function(a){var b={},c;a.autocomplete({source:function(a,e){if(b[a.term])return e(b[a.term]);
else c=JUMO.Util.ajaxGet({url:"/json/v1/autocomplete",data:{q:a.term},success:function(f,g,j){b[a.term]=f.result;return j===c&&f&&f.result?e(f.result):e([])},error:function(){}})},select:function(b,c){JUMO.Modules.Tracking.trackActionSYNC("Autocomplete Select",{query:a.val(),"item found":c.item.label,"item index":c.item.index});a.val(c.item.label);return!1},minLength:2}).data("autocomplete")._renderItem=function(a,b){b.index=a.children("li").length;return jQuery("<li></li>").data("item.autocomplete",
b).append("<a>"+b.label+"</a>").appendTo(a)}}};JUMO.Modules.Tracking={initialize:function(a){var b=this,c=a.trackingmodule,d=a.mixPanelInit;this.trackAction=function(a,b,d){c.push(["track",a,b]);d&&d()};this.trackActionSYNC=function(a,c,e){if(!b.mixPanel)b.mixPanel=d();b.mixPanel.track(a,c,e)};this.trackFunnel=function(a,b){c.push(["track",a,b])};this.registerUser=function(a){a.id&&c.push(["identify",a.id]);c.push(["register",{"signed in":a.signedIn,gender:a.gender,"age group":a.ageGroup}])};if(!a.doNotTrackPageload){var e=window.location?window.location.pathname:
"";this.registerUser({id:a.userId,gender:a.userGender,ageGroup:a.userAgeGroup,signedIn:a.signedIn});c.push(["track","Page Load",{location:e}])}this.initialized=!0}};
