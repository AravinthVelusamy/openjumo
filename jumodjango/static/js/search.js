JUMO.SearchResults={parent:JUMO,limit:20,currentQuery:void 0,currentType:void 0,currentLocation:void 0,currentOffset:0,initialize:function(){this.searchBox=jQuery("#search_box");this.searchButton=jQuery("#search_button");this.leftSide=jQuery("#facets");this.searchResults=jQuery(".search_results");this.locationFilters=jQuery("#location_filters a");this.nearMe=jQuery("#near_me");this.moreResults=jQuery("#more_results");this.pageHeading=jQuery("h1");this.relatedSearches=jQuery(".related_search_queries");
this.currentQuery=this.parent.Util.getUrlParameterByName("q");this.setupEvts();if(JUMO.browserIsIE){var a=this.searchBox.val()||this.searchBox.text();a&&a.length>0||(JUMO.Util.initPlaceholder(this.searchBox),this.searchBox.bind("focus blur",function(a){JUMO.Util.fixPlaceHolder(jQuery(a.target),a.type)}))}},setupEvts:function(){var a=this;this.searchButton.click(function(c){c.preventDefault();$(this).focus();a.submitSearch({query:a.searchBox.val()})});this.locationFilters.click(function(c){c.preventDefault();
var c=jQuery(this),b=c.attr("data-val");jQuery("#location_filters a").removeClass("selected");c.addClass("selected");a.submitSearch({location:b})});this.leftSide.find(".filter").live("click",function(){var c=jQuery(this),b=c.find("span.name"),d=b.attr("data-type"),b=b.text();a.submitSearch({query:a.currentQuery,type:d,doNotRebuildFacets:!0});a.leftSide.find(".filter").removeClass("selected");c.addClass("selected");a.pageHeading.text(b)});this.moreResults.click(function(){a.submitSearch({query:a.currentQuery,
doNotRebuildSearchItems:!0,offset:a.currentOffset+a.limit})})},submitSearch:function(a){var c=this;this.currentQuery=a.query||this.currentQuery;this.currentType=a.type||this.currentType;this.currentLocation=a.location||this.currentLocation;this.currentOffset=a.offset||0;var b={q:this.currentQuery,format:"html",type:this.currentType,location:this.currentLocation,lat:this.userLocation?this.userLocation.lat:void 0,lng:this.userLocation?this.userLocation.lng:void 0,limit:this.limit,offset:this.currentOffset};
JUMO.Util.ajaxGet({url:"/json/v1/search",data:b,success:function(b){if(b&&b.result){a.doNotRebuildFacets||c.leftSide.html(b.result.facets);if(a.doNotRebuildSearchItems){c.searchResults.find("li").last().removeClass("last");var e=jQuery(b.result.items);e.filter("li").first().removeClass("first");c.searchResults.append(e)}else c.searchResults.html(b.result.items);c.moreResults.html(b.result.more_results);c.relatedSearches.html(b.result.related);b.result.nearMe&&c.nearMe.html(b.result.nearMe)}}});this.userLocation||
this.updateNearMe(b)},setUserLocation:function(a,c){this.userLocation={lat:a,lng:c}},getUserLocation:function(a){var c=this;this.userLocation?a(this.userLocation.lat,this.userLocation.lng):navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){c.setUserLocation(b.coords.latitude,b.coords.longitude);a(b.coords.latitude,b.coords.longitude)},function(){a(void 0,void 0)}):window.google&&google.gears?google.gears.factory.create("beta.geolocation").getCurrentPosition(function(b){c.setUserLocation(b.latitude,
b.longitude);a(b.latitude,b.longitude)},function(){a(void 0,void 0)}):a(void 0,void 0)},updateNearMe:function(a){var c=this;this.getUserLocation(function(b,d){a.lat=b;a.lng=d;JUMO.Util.ajaxGet({url:"/json/v1/search",data:a,success:function(a){a!==void 0&&a.result!==void 0&&a.result.nearMe!==void 0&&c.nearMe.html(a.result.nearMe)}})})}};
